{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { useState } from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport firebase from 'firebase/compat/app';\nimport { db, auth } from \"../.././firebase.js\";\nimport { serverTimestamp } from \"firebase/firestore\";\nimport { getStorage, ref, uploadBytes } from \"firebase/storage\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\n\nrequire(\"firebase/compat/firestore\");\n\nrequire('firebase/compat/storage');\n\nexport default function Save(props) {\n  var _useState = useState(\"\"),\n      _useState2 = _slicedToArray(_useState, 2),\n      caption = _useState2[0],\n      setCaption = _useState2[1];\n\n  var uploadImage = function _callee() {\n    var uri, childPath, response, blob, task, taskProgress, taskCompleted, taskError;\n    return _regeneratorRuntime.async(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            uri = props.route.params.image;\n            childPath = \"post/\" + firebase.auth().currentUser.uid + \"/\" + Math.random().toString(36);\n            _context.next = 4;\n            return _regeneratorRuntime.awrap(fetch(uri));\n\n          case 4:\n            response = _context.sent;\n            _context.next = 7;\n            return _regeneratorRuntime.awrap(response.blob());\n\n          case 7:\n            blob = _context.sent;\n            task = firebase.storage().ref().child(childPath).put(blob);\n\n            taskProgress = function taskProgress(snapshot) {\n              console.log(\"transferred: \" + snapshot.bytesTransferred);\n            };\n\n            taskCompleted = function taskCompleted() {\n              task.snapshot.ref.getDownloadURL().then(function (snapshot) {\n                savePostData(snapshot);\n                console.log(snapshot);\n                Alert.alert(\"Success\");\n              });\n            };\n\n            taskError = function taskError(snapshot) {\n              console.log(snapshot);\n            };\n\n            task.on(\"state_changed\", taskProgress, taskError, taskCompleted);\n\n          case 13:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var savePostData = function savePostData(downloadURL) {\n    db.collection('posts').doc(auth.currentUser.uid).collection(\"userPosts\").add({\n      downloadURL: downloadURL,\n      caption: caption,\n      creation: serverTimestamp()\n    }).then(function () {\n      props.navigation.popToTop();\n    }).catch(function (error) {\n      console.log(error);\n    });\n  };\n\n  return _jsxs(View, {\n    style: styles.container,\n    children: [_jsx(Image, {\n      source: {\n        uri: props.route.params.image\n      },\n      style: styles.image\n    }), _jsx(TextInput, {\n      placeholder: \"Write a Caption...\",\n      onChangeText: function onChangeText(caption) {\n        return setCaption(caption);\n      }\n    }), _jsx(Button, {\n      title: \"Send Post\",\n      onPress: function onPress() {\n        return uploadImage();\n      }\n    })]\n  });\n}\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1\n  },\n  image: {\n    flex: 1\n  }\n});","map":{"version":3,"names":["React","useState","firebase","db","auth","serverTimestamp","getStorage","ref","uploadBytes","require","Save","props","caption","setCaption","uploadImage","uri","route","params","image","childPath","currentUser","uid","Math","random","toString","fetch","response","blob","task","storage","child","put","taskProgress","snapshot","console","log","bytesTransferred","taskCompleted","getDownloadURL","then","savePostData","Alert","alert","taskError","on","downloadURL","collection","doc","add","creation","navigation","popToTop","catch","error","styles","container","StyleSheet","create","flex"],"sources":["C:/Users/ragha/OneDrive/Desktop/Projects/instagram-clone/components/main/Save.js"],"sourcesContent":["import React, { useState } from 'react'\r\nimport { View, TextInput, Image, StyleSheet, Button,Alert } from 'react-native'\r\nimport firebase from 'firebase/compat/app';\r\nimport {db, auth} from \"../.././firebase.js\"\r\nimport {serverTimestamp} from \"firebase/firestore\";\r\nimport { getStorage, ref, uploadBytes } from \"firebase/storage\"\r\nrequire(\"firebase/compat/firestore\")\r\nrequire('firebase/compat/storage')\r\n\r\nexport default function Save(props) {\r\n    const [caption, setCaption] = useState(\"\");\r\n\r\n    const uploadImage = async () => {\r\n        const uri = props.route.params.image;\r\n        const childPath = `post/${firebase.auth().currentUser.uid}/${Math.random().toString(36)}`;\r\n        const response = await fetch(uri);\r\n        const blob = await response.blob();\r\n\r\n        const task = firebase.storage().ref().child(childPath).put(blob)\r\n        const taskProgress = snapshot => {\r\n            console.log(`transferred: ${snapshot.bytesTransferred}`)\r\n        }\r\n\r\n        const taskCompleted = () => {\r\n            task.snapshot.ref.getDownloadURL().then((snapshot) => {\r\n                savePostData(snapshot);\r\n                console.log(snapshot)\r\n                Alert.alert(\"Success\")\r\n            })\r\n        }\r\n\r\n        const taskError = snapshot => {\r\n            console.log(snapshot)\r\n        }\r\n\r\n        task.on(\"state_changed\", taskProgress, taskError, taskCompleted)\r\n    }\r\n\r\n    const savePostData = (downloadURL) => {\r\n        db.collection('posts').doc(auth.currentUser.uid).collection(\"userPosts\").add({\r\n            downloadURL,\r\n            caption,\r\n            creation: serverTimestamp()\r\n        }).then((function () {\r\n            props.navigation.popToTop();\r\n        })).catch(error => {\r\n            console.log(error)\r\n        })\r\n    }\r\n\r\n    return (\r\n        <View style={styles.container}>\r\n            <Image source={{ uri: props.route.params.image }} style={styles.image} />\r\n            <TextInput placeholder='Write a Caption...' onChangeText={(caption) => setCaption(caption)} />\r\n            <Button title='Send Post' onPress={() => uploadImage()} />\r\n        </View>\r\n    )\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n    container: {\r\n        flex: 1,\r\n    },\r\n    image: {\r\n        flex: 1,\r\n    }\r\n})\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}